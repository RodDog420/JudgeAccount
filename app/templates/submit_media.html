{% extends "base.html" %}
{% block title %}Submit Media Link - Judge Review{% endblock %}
{% block content %}
<h1>Submit a Media Link</h1>
<p>Share news articles, court records, or documented reports about a judge.</p>
<form method="POST" action="{{ url_for('main.submit_media_link') }}">
    {{ form.hidden_tag() }}
    {% if prefilled_judge %}
    <input type="hidden" name="prefilled_judge_id" value="{{ prefilled_judge.id }}">
    {% endif %}
    
    <h3>Judge Information</h3>

    <div class="form-group">
        {{ form.judge_first_name.label }}
        {% if prefilled_judge %}
            {{ form.judge_first_name(class="form-control user-content-name", disabled="disabled") }}
        {% else %}
            {{ form.judge_first_name(class="form-control") }}
        {% endif %}
        {% if form.judge_first_name.errors %}
            {% for error in form.judge_first_name.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.judge_last_name.label }}
        {% if prefilled_judge %}
            {{ form.judge_last_name(class="form-control user-content-name", disabled="disabled") }}
        {% else %}
            {{ form.judge_last_name(class="form-control") }}
        {% endif %}
        {% if form.judge_last_name.errors %}
            {% for error in form.judge_last_name.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.state.label }}
        {% if prefilled_judge %}
            {{ form.state(class="form-control", id="state-select", disabled="disabled") }}
        {% else %}
            {{ form.state(class="form-control", id="state-select") }}
        {% endif %}
        {% if form.state.errors %}
            {% for error in form.state.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.court.label }}
        {% if prefilled_judge %}
            {{ form.court(class="form-control user-content-name", id="court-select", disabled="disabled") }}
        {% else %}
            {{ form.court(class="form-control", id="court-select") }}
        {% endif %}
        {% if form.court.errors %}
            {% for error in form.court.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.city.label }}
        {% if prefilled_judge %}
            {{ form.city(class="form-control user-content-name", disabled="disabled") }}
        {% else %}
            {{ form.city(class="form-control") }}
        {% endif %}
        {% if form.city.errors %}
            {% for error in form.city.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="checkbox-group">
        {% if prefilled_judge %}
            {{ form.is_federal(disabled="disabled") }}
        {% else %}
            {{ form.is_federal() }}
        {% endif %}
        {{ form.is_federal.label }}
    </div>

    <div class="checkbox-group">
        {% if prefilled_judge %}
            {{ form.is_retired(disabled="disabled") }}
        {% else %}
            {{ form.is_retired() }}
        {% endif %}
        {{ form.is_retired.label }}
    </div>
    
    <h3>Media Link Details</h3>
    
    <div class="form-group">
        {{ form.headline.label }}
        {{ form.headline(class="form-control", placeholder="Enter the article or report headline...") }}
        {% if form.headline.errors %}
            {% for error in form.headline.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.news_source.label }}
        {{ form.news_source(class="form-control", placeholder="e.g., New York Times, Court Records, AP News") }}
        {% if form.news_source.errors %}
            {% for error in form.news_source.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.url.label }}
        {{ form.url(class="form-control", placeholder="https://...") }}
        {% if form.url.errors %}
            {% for error in form.url.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.publication_date.label }}
        {{ form.publication_date(class="form-control") }}
        {% if form.publication_date.errors %}
            {% for error in form.publication_date.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.summary.label }}
        {{ form.summary(class="form-control", placeholder="Provide a brief summary of what this article/report discusses about the judge...") }}
        {% if form.summary.errors %}
            {% for error in form.summary.errors %}
                <span class="error">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>
    
    <div class="form-group">
        {{ form.submit(class="btn btn-primary") }}
    </div>
</form>

<script>
// Convert Python dictionary to JavaScript object
const courtsByState = {{ courts_by_state | tojson }};

// Get the state and court dropdown elements
const stateSelect = document.getElementById('state-select');
const courtSelect = document.getElementById('court-select');

// Store the pre-selected court value (if any)
{% if prefilled_judge %}
const preselectedCourt = "{{ prefilled_judge.court }}";
{% else %}
const preselectedCourt = null;
{% endif %}

// Function to update court dropdown based on selected state
function updateCourtOptions() {
    const selectedState = stateSelect.value;
    
    // Clear current court options
    courtSelect.innerHTML = '<option value="">Select a court...</option>';
    
    // If a state is selected, add its courts
    if (selectedState && courtsByState[selectedState]) {
        courtsByState[selectedState].forEach(function(court) {
            const option = document.createElement('option');
            option.value = court[0];  // The court value
            option.text = court[1];   // The court display name
            
            // Pre-select the court if it matches
            if (preselectedCourt && court[0] === preselectedCourt) {
                option.selected = true;
            }
            
            courtSelect.appendChild(option);
        });
        courtSelect.disabled = preselectedCourt ? true : false;  // Disable if pre-filled
    } else {
        courtSelect.disabled = true;
    }
}

// Listen for state selection changes
stateSelect.addEventListener('change', updateCourtOptions);

// Initialize on page load
updateCourtOptions();
</script>
{% endblock %}