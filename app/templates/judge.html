{% extends "base.html" %}
{% block title %}{{ judge.full_name() }} - Judge Review{% endblock %}
{% block content %}
<div class="judge-profile">
    <h1>{{ judge.full_name() }}
        {% if judge.is_federal %}
            <span class="badge badge-federal">Federal Judge</span>
        {% endif %}
        {% if judge.is_retired %}
            <span class="badge badge-retired">Retired</span>
        {% endif %}
    </h1>
    
    <div class="judge-info">
        <div class="judge-info-item">
            <span class="judge-info-label">Court</span>
            <span class="judge-info-value">{{ judge.court }}</span>
        </div>
        <div class="judge-info-item">
            <span class="judge-info-label">Location</span>
            <span class="judge-info-value">{{ judge.city }}, {{ judge.state }}</span>
        </div>
    </div>
    
    <div class="stats-container">
        <div class="stat-box">
            <span class="stat-number">{{ "%.1f"|format(judge.average_rating()) if judge.review_count() > 0 else "N/A" }}</span>
            <span class="stat-label">Average Rating</span>
        </div>
        <div class="stat-box">
            <span class="stat-number">{{ judge.review_count() }}</span>
            <span class="stat-label">Total Reviews</span>
        </div>
        <div class="stat-box">
            <span class="stat-number">{{ verified_links|length }}</span>
            <span class="stat-label">Verified Media Links</span>
        </div>
    </div>
</div>

<!-- Media Links Section -->
<h2>Media Links</h2>
<p class="media-description">
    Documented news articles, court records, and reports about this judge.
</p>
{% set verified_links = judge.media_links|selectattr('is_verified', 'equalto', True)|list %}
{% if verified_links %}
    {% for media_link in verified_links %}
    <div class="media-link-card">
        <div class="media-link-header">
            <h3 class="media-link-headline">
                <a href="{{ media_link.url }}" target="_blank" rel="noopener noreferrer">
                    {{ media_link.headline }}
                </a>
            </h3>
            <span class="media-link-source">{{ media_link.news_source }}</span>
        </div>
        
        <div class="media-link-date">
            Published: {{ media_link.publication_date.strftime('%B %d, %Y') }}
        </div>
        
        <div class="media-link-summary">
            {{ media_link.summary }}
        </div>
        
        <div class="content-footer">
            <a href="{{ media_link.url }}" target="_blank" rel="noopener noreferrer" class="btn media-link-button">
                Read Full Article →
            </a>
            <div>
                <span class="media-link-submitted">
                    Submitted: {{ media_link.created_at.strftime('%B %d, %Y') }}
                </span>
                {% if current_user.is_authenticated and media_link.user_id != current_user.id %}
                    {% if media_link.has_pending_flag %}
                        <span class="text-muted text-smaller report-link">⚠️ Flagged - pending admin inspection</span>
                    {% else %}
                        <a href="{{ url_for('auth.flag_media_link', media_link_id=media_link.id) }}" 
                            class="btn btn-danger btn-small report-link">
                            Report
                        </a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- Submit Button - Always show when media links exist -->
    <div class="spacing-top-md">
        <a href="{{ url_for('main.submit_media_link', judge_id=judge.id) }}" class="btn btn-primary">
            Submit a Media Link
        </a>
    </div>
{% else %}
    <div class="no-media-links">
        <p>No verified media links yet for this judge.</p>
        <p>Media link verification typically takes up to 72 hours.<br>Submitted links will appear here once approved by our moderation team.</p>
        <a href="{{ url_for('main.submit_media_link', judge_id=judge.id) }}" class="btn btn-primary">Submit a Media Link</a>
    </div>
{% endif %}

<!-- Reviews Section -->
<h2 class="spacing-top-lg">Reviews</h2>
{% if reviews %}
    {% for review in reviews %}
    <div class="review-card">
        <div class="review-header">
            <span class="review-rating">{{ review.rating }} / 5 stars</span>
            <span class="review-date">Court Date: {{ review.court_date.strftime('%B %d, %Y') }}</span>
        </div>
        
        {% if review.fairness_concern or review.bias_concern or review.temperament_concern %}
        <div class="review-concerns">
            {% if review.fairness_concern %}
                <span class="badge badge-fairness">Fairness Concern</span>
            {% endif %}
            {% if review.bias_concern %}
                <span class="badge badge-bias">Bias Concern</span>
            {% endif %}
            {% if review.temperament_concern %}
                <span class="badge badge-temperament">Temperament Concern</span>
            {% endif %}
        </div>
        {% endif %}
        
        <div class="review-text">
            {{ review.review_text }}
        </div>
        
        <div class="content-footer">
            <span class="review-date submitted-date">
                Submitted: {{ review.created_at.strftime('%B %d, %Y') }}
            </span>
            {% if current_user.is_authenticated and review.user_id != current_user.id %}
            <div>
                {% if review.has_pending_flag %}
                    <span class="text-muted text-smaller">⚠️ Flagged - pending admin inspection</span>
                {% else %}
                    <a href="{{ url_for('auth.flag_review', review_id=review.id) }}" 
                        class="btn btn-danger btn-small">
                        Report
                    </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}

    <!-- Submit Button - Always show when reviews exist -->
    <div class="spacing-top-md">
        <a href="{{ url_for('main.submit_review', judge_id=judge.id) }}" class="btn btn-primary">
            Submit a Review
        </a>
    </div>
{% else %}
    <div class="no-reviews">
        <p>No reviews yet for this judge.</p>
        <a href="{{ url_for('main.submit_review', judge_id=judge.id) }}" class="btn btn-primary">Be the First to Review</a>
    </div>
{% endif %}
{% endblock %}